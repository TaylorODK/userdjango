# Userdjango
## Описание

Тестовое задание по созданию backend-приложение с собственной системой аутентификации и авторизации. 
Для просмотра доступных эндпоинтов был добавлен swagger (api/v1/swagger/)
## Приложение Users
### UserModel - пользователь
Кастомный пользователь для проекта. Аутентификация проходит через поле email.
Для создания пользователя необходимо отправить post-запрос на адрес api/v1/users/
Пример запроса:
```
    {   
        "email": "bma90@mail.ru",
        "first_name": "Михаил",
        "last_name": "Баширов",
        "password": "A1!23456",
        "repeat_password": "A1!23456"
    }
```
Для аутентификации на сайте необходимо отправить post-запрос на адрес api/v1/users/auth/login/
Пример запроса:
```
    {
        "email": "string",
        "password": "string"
    }
```
Пример ответа
```
    {
        "refresh": "example",
        "access": "example"
    }
```
В дальнейшем при каждом запросе к API нужно в заголовке запроса, в поле Authorization, передавать основной токен доступа, полученный в поле access. Перед самим токеном должно стоять ключевое слово Bearer и пробел: Bearer token

Доступные операции с профилем:
- просмотр профиля /api/v1/users/me/ (get-запрос)
- изменение данных профиля /api/v1/users/me/ (patch-запрос)
Пример запроса:
```
    {
        "email": "user@example.com",
        "first_name": "string",
        "last_name": "string"
    }
```
- изменение пароля /api/v1/users/me/change-password/ (patch-запрос)
Пример запроса:
```
    {
        "password": "string",
        "new_password": "string",
        "repeat_password": "string"
    }
```
- удаление аккаунта /api/v1/users/me/delete/ (patch-запрос)
Пример запроса:
```
    {
        "email": "user@example.com",
        "password": "string"
    }
```
- просмотр доступа пользователя к моделям api /api/v1/users/me/permissions/{model_name}/
В папке backend/fixtues/ добавлен файл users.json для заполнения тестовыми данными (5 пользователей, 5 менеджеров (пароль "A1!23456" без кавычек))
### Role - система ролей пользователя:
По умолчанию предусмотрены следующие роли для пользователей:
- **"Гость"**: "guest"
- **"Администратор"**: "admin"
- **"Менеджер"**: "manager"
- **"Пользователь"**: "user"
Данные роли автоматически занесены в таблицу Role с помощью миграций.
Администратору доступно создание дополнительных ролей в админке.
### BusinessElement - элементы проекта
Объектами таблицы являются модели приложения api. 
Миграциями предусмотрено автоматическое заполнение таблицы на основе наименования моделей приложения api.
Администратору доступно создание дополнительных элементов в админке.
### AccessRolesRule - уровни доступа
Таблица содержит информацию о ролях, элемантах и уровнях доступа по определенным действиям
Миграциями предусмотрено автоматическое заполнение таблицы.
Администратору доступно редактирование доступа, а также создание дополнительных правил доступа.
### Уровни доступа (по умолчанию):
- **ГОСТЬ** (неавторизованный пользователь) - доступен только просмотр модели Products, как списка, так и каждого отдельного элемента
- **АДМИНИСТРАТОР** - доступны все операции по всем моделям
- **МЕНЕДЖЕР** - доступны все операции по всем моделям
- **ПОЛЬЗОВАТЕЛЬ** - доступны операции по созданию/просмотру/редактированию/удалению собственных заказов (Order), а также просмотр модели Product. Роль устанавливается новым пользователям по умолчанию. Изменение роли возможно через админку.
Пользователю доступен просмотр собственного уровня доступа через адрес /api/v1/users/me/permissions/{наименование модели(например(product))}/
## Приложение API
Приложение для тестирования уровней доступа, включает в себя 2 модели Product и Order.
### Product - модель продуктов
Модель продуктов. В модель включены следующие поля:
- наименование
- слаг
- стоимость
- описание
Для модели доступны следующие эндпоинты:
- создание продукта api/v1/product/ post-запрос
- просмотр списка всех продуктов api/v1/product/ get-запрос
- просмот продукта по id api/v1/product/{id}/ get-запрос
- редактирование продукта по id api/v1/product/{id}/ patch и put - запросы
- удаление продукта по id api/v1/product/{id}/ delete - запросы
В папке backend/fixtues/ добавлен файл products.json для заполнения тестовыми данными (6 продуктов)
### Order - модель заказов
Модель заказов. В модель включены следующие поля:
- пользователь
- дата заказа
- продукт
Для модели доступны следующие эндпоинты:
- создание заказа api/v1/order/ post-запрос
- просмотр списка всех заказов api/v1/order/ get-запрос
- просмот заказа по id api/v1/order/{id}/ get-запрос
- редактирование заказа по id api/v1/order/{id}/ patch и put - запросы
- удаление заказа по id api/v1/order/{id}/ delete - запросы
В папке backend/fixtues/ добавлен файл order.json для заполнения тестовыми данными (5 заказов)

## Установка и запуск проекта
```
1. Клонируйте репозиторий через Git
cd <ваша директория, в которую вы хотите разместить проект>
git clone <SSH-ключ данного репозитория>
2. Создайте виртуальное окружение и активируйте его
Windows
python -m venv venv
source venv/Scripts/activate
Linux/macOS
python3 -m venv venv
source venv/bin/activate
3. Установите зависимости
pip install -r backend/requirement.txt
3. В настоящее время база данных реализована через sqlite3. В будущем будет дополнительно реализован переход на Postgres.
4. Для локального запуска проекта необходимо выполнить следующие команды:
- cd backend/
- python manage.py migrate
5. Добавление тестовых данных (фикстур) по одной в следующем порядке:
- python manage.py loaddata fixtures/users.json 
- python manage.py loaddata fixtures/products.json 
- python manage.py loaddata fixtures/order.json 
- python manage.py runserver
6. Данные для авторизации в админке:
- логин admn@mail.ru
- пароль 123456
7. Пример заполнения .env файла:
DEBUG=True
SECRET_KEY='django-insecure-xdreb-bul$(qx@*&flyg)m$ep$kx-4+@#ft%v+r@j$m7w^fhl='
```


